# MCS-Cov-Mental-Health-
## Overview
This README File has been found in a larger zip folder called `analysis_CovidYAMH`, which contains the following files, and require R software to open:
- `CovidYAMH.Rproj`
- `.RHistory`
- `_targets.R`
- `run.R`
- `run.sh`
- `.Rprofile`
- `_targets` (folder)
- `Figures_Tables` (empty folder)
- `MCS_data` (empty folder)
- `R` (folder)
- `UKLHS_data` (empty folder)

`COVID.YAMH.Rproj` is the **RStudio workspace**. Clicking on this file, with R and RStudio downloaded onto your computer, will open an R session oriented to read the files contained within the `analysis_COVID.YAMH` folder. The files in this workspace were initially generated with the `targets 1.4.0` software package (Landau _et al._, 2023) and adapted to the authors' data analysis needs. With the help of the `targets` package, the files in this workspace are read together as part of a pipeline, which safeguards the data analysis process and facilitates replicability. 

The **user-made functions**, which provide the information required to clean and analyse the data, are stored in the folder, `R`. The`_targets.R` file contains pipeline specifications, which dictate which of these functions should be run, and when. 

All the software packages that are needed to run the user-made functions are listed in the` _targets.R` file as part of the pipeline setup. You will need these packages downloaded before you are able to run the pipeline and a functional `.Rprofile` file to handle any library conflicts. This README file provides both the materials and the procedure required for downloading all necessary packages into your version of R. This document will also provide the information you need to enable the `.Rprofile` file to ensure smooth function running.

The user-made functions in the `R` folder read, clean, and analyse data from the Millennium Cohort Study (MCS) mainstage survey and special COVID-19 survey as well as from the Understanding Society (UKLHS) special COVID-19 survey. All of the data in the folders `MCS_data` and `UKLHS_data` has been removed due to data restrictions. You must download your own version of the data from the UK Data Service. This README file will provide further details on how to download the data and set up the workspace for your own computer. 

After setting up the workspace per this README file's instructions, in the console, type `tar_make()` and press `Enter` to run all of the code needed to convert the raw downloaded data into the 1 figure and 13 tables (which are automatically saved into the initially empty `Figures_Tables` folder) in the manuscript and its online appendix. You should expect the code to run for about 70 minutes.
## Data Availability and Provenance Statements

The paper uses data from the United Kingdom's (UK) Millennium Cohort Study (MCS) Waves 1 through 7 (CLS, 2022a-e; CLS, 2020a–b) and the COVID-19 Survey in Five National Longitudinal Cohort Studies (UCL, 2022). In robustness checks, this paper also considers the Understanding Society: COVID-19 Study, 2020-2021 (University of Essex, ISER, 2021). 

All data are stored in a free online repository, the UK Data Service (UKDS). You can access and download the data for non-commercial use after registering an account with UKDS (e.g., via a higher education or research institute). The data are 'Safeguarded', meaning access is contingent upon acceptance of the UKDS terms and conditions, which includes an [End User License Agreement](https://ukdataservice.ac.uk/app/uploads/cd137-enduserlicence.pdf) and wave-specific conditions related to respondent identification restrictions. 
### Data Rights and License Statement
I certify that the author(s) of the manuscript have obtained an End User License for each dataset and have been provided legitimate access to and permission to use the data in this paper. The authors certify that the data was used for academic purposes alone and not for commercial purposes. 

The data are licensed under an End User License Agreement/CD137-EndUserLicence_11.00w license. See [End User License Agreement](https://ukdataservice.ac.uk/app/uploads/cd137-enduserlicence.pdf) for details.
### Accessing the Data on UKDS
All data are freely available to verified accounts to download for non-commercial use through the UKDS. 

At each of the dataset UKDS pages (full links in Table 1), click "Access Data", which is available to UKDS account holders. The data will then be added to the user's account, which means it can be added to a project. Assign the data to a project, read and agree to the terms and conditions of use, and agree to any additional study specific conditions that may arise. Once access is granted, the survey data file will show in the User's project page, with a green indicator labelled "Active", and can now be selected and downloaded. 
### Details on Each Data Source
The main manuscript uses MCS data and UKLHS data. MCS data is organised such that each wave of the mainstage survey is considered a separate study and the COVID-19 study is also help separately. Contrastingly, the UKLHS COVID-19 survey is considered a single study in the repository. Details on how to find each data source is contained in Table 1.

**Table 1**:
*A table containing links to each piece of data used in to produce the tables in the manuscript and online appendix*

| Data Name                                                                                                                                                                           | Version | UK Data Service Link                                         | Reference    |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- | ----------------------------------------------------------- | ------------ |
| “Millennium Cohort Study: Age 9 months, Sweep 1, 2001”                                                                                                                              | 14.0    | [Study ID 4683](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=4683) | (CLS, 2022a) |
| "Millennium Cohort Study: Age 3, Sweep 2, 2004"                                                                                                                                     | 11.0    | [Study ID 5350](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=5350)| (CLS, 2022b) |
| "Millennium Cohort Study: Age 5, Sweep 3, 2006"                                                                                                                                     | 9.0     | [Study ID 5795](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=5795) | (CLS, 2022c) |
| "Millennium Cohort Study: Age 7, Sweep 4, 2008"                                                                                                                                     | 8.0     | [Study ID 6411](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=6411) | (CLS, 2020a) |
| "Millennium Cohort Study: Age 11, Sweep 5, 2012"                                                                                                                                    | 5.0     | [Study ID 7464](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=7464) | (CLS, 2020b) |
| "Millennium Cohort Study: Age 14, Sweep 6, 2015"                                                                                                                                    | 7.0     | [Study ID 8156](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8156) | (CLS, 2022d) |
| "Millennium Cohort Study: Age 17, Sweep 7, 2018"                                                                                                                                    | 2.0     | [Study ID 8682](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8682) | (CLS, 2022e) |
| “COVID-19 Survey in Five National Longitudinal Cohort Studies: Millennium Cohort Study, Next Steps, 1970 British Cohort Study and 1958 National Child Development Study, 2020-2021” | 4.0     | [Study ID 8658](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8658) | (UCL, 2022)  |
| "Understanding Society: COVID-19 Study, 2020-2021."         |    11.0     |       [Study ID 8644](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8644)                                                               |      (University of Essex, ISER, 2021)        |

### Downloading the Data
All the the surveys in a selection will be downloaded in one singular zip file. You want to ensure the files being download are in the `TAB` file format. 

To ensure the pipeline functions correctly, it is important to download the two different studies (MCS vs UKLHS) separately. First, download all 8 MCS studies (which is all but one of the studies included in your project). Ensure the download is saved into the empty `MCS_data` folder. Unzip the file containing MCS data in the `MCS_data` folder. The unzipped file should have 8 folders corresponding to each relevant wave of MCS mainstage survey data collection. For the purposes of successfully using this replication package, the folders should be renamed `"mcs_Cov", "mcs_wave1", "mcs_wave2", "mcs_wave3", "mcs_wave4", "mcs_wave5", "mcs_wave6", "mcs_wave7"`.

After setting up the MCS data, download the singular UKLHS study, and ensure the zip file is downloaded and unzipped into the `UKLHS_data` folder.

The UKDS downloaded and unzipped files are organised into two folders and two files, named `mrdoc` (folder), `tab` (folder), an information table file (`.rtf`) and a ReadMe (`.htm`) file. The information tables describes all the files in each folder and ReadMe files document edition information and curation procedures. The `mrdoc` folder contains all written survey related information and data dictionaries, including technical reports, questionnaires, and user guides. 

Each`tab` folder contains all of the respective study's data files. This raw survey data is downloaded as `.tab` files. Table 2 lists all of the files relevant to the paper and the file path as per the download instructions:

**Table 2**:
*A tabulation of each relevant data file and the respective file path as per the instructions written in this README file*

| Study Reference                  | Relevant Data Files                                                                                                                                                                                                                                                                  | File Path                 |     |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------- | --- |
| UCL (2022)                       | covid-19_wave1_survey_cls.tab<br>covid-19_wave2_survey_cls.tab<br>covid-19_wave3_survey_cls.tab                                                                                                                                                                                      | MCS_data/MCS_Cov/tab/     |     |
| CLS (2022a)                      | mcs1_cm_derived.tab<br>mcs1_family_derived.tab<br>mcs1_hhgrid.tab<br>mcs1_parent_derived.tab                                                                                                                                                                                         | MCS_data/mcs_wave1/tab/   |     |
| CLS (2022b)                      | mcs2_cm_derived.tab<br>mcs2_family_derived.tab<br>mcs2_hhgrid.tab<br>mcs2_parent_derived.tab                                                                                                                                                                                         | MCS_data/mcs_wave2/tab/   |     |
| CLS (2022c)                      | mcs3_cm_derived.tab<br>mcs3_family_derived.tab<br>mcs3_hhgrid.tab<br>mcs3_parent_derived.tab                                                                                                                                                                                         | MCS_data/mcs_wave3/tab/   |     |
| CLS (2020a)                      | mcs4_cm_derived.tab<br>mcs4_family_derived.tab<br>mcs4_hhgrid.tab<br>mcs4_parent_derived.tab                                                                                                                                                                                         | MCS_data/mcs_wave4/tab/   |     |
| CLS (2020b)                      | mcs5_cm_derived.tab<br>mcs5_family_derived.tab<br>mcs5_hhgrid.tab<br>mcs5_parent_derived.tab                                                                                                                                                                                         | MCS_data/mcs_wave5/tab/   |     |
| CLS (2022d)                      | mcs6_cm_derived.tab<br>mcs6_family_derived.tab<br>mcs6_hhgrid.tab<br>mcs6_parent_derived.tab                                                                                                                                                                                         | MCS_data/mcs_wave6/tab/   |     |
| CLS (2022e)                      | mcs7_cm_derived.tab<br>mcs7_family_derived.tab<br>mcs7_hhgrid.tab<br>mcs7_parent_derived.tab                                                                                                                                                                                         | MCS_data/mcs_wave7/tab/   |     |
| University of Essex, ISER (2021) | cb_indresp_w.tab<br>cc_indresp_w.tab<br>cd_indresp_w.tab<br>ce_indresp_w.tab<br>cf_indresp_w.tab<br>cg_indresp_w.tab<br>ch_indresp_w.tab<br>ci_indresp_w.tab<br>mainstage_data_2019/jk_indresp_cv.tab<br>mainstage_data_2019/jk_egoalt_cv.tab<br>mainstage_data_2019/jk_youth_cv.tab | UKLHS_data/UKDA-8644-tab/ |     |
*Table 2 Notes*: each file path assumes the R workspace is set up such that files are saved and sourced using the `/analysis_CovidYAMH/` folder as the primary directory. These paths were built to run on a Mac, for Windows computer, you would need to supplement the front-slash (`/`) with a back-slash (`\`).
### Preliminary Code during the Editorial Process
Code for data cleaning and analysis is provided as part of this replication package for review. It can be uploaded to a European Societies journal repository once the paper has been conditionally accepted.
## Computational requirements
The specific code and lock.files used to generate the results in our article are contained in the same zip-file with this README pdf. This section discusses the computational requirements, including shared library or code packages, required software, and specific computing hardware that are useful for replication. 
### Software Requirements
The code here was last ran using RStudio (version 2023.12.0+369) with R (version 4.3.2, 2023-10-31).  Upon opening RStudio, ensure the following packages are downloaded:
- `conflicted` version 1.2.0
- `dplyr` version 1.1.4
- `ggpubr` version 0.6.0
- `gt` version 0.8.0
- `gtsummary` version 1.7.0
- `haven` version 2.5.1
- `Hmisc` version 4.7-2
- `knitr` version 1.41
- `lmtest` version 0.9-40
- `mice` version 3.15.0
- `modelsummary` version 1.3.0
- `plm` version 2.6-3
- `RColorBrewer` version 1.1-3
- `sandwich` version 3.0-2
- `srvyr` version 1.1.2
- `targets` version 1.4.0
- `tidyverse` version 1.3.2
- `tseries` version 0.10-54
- `webshot2` version 0.1.0
- `weights` version 1.0.4

You can download the required packages with the point-and-click functions in R, or, you can copy and paste the following code into your RStudio console:
```R
install.packages(c("clubSandwich","conflicted", "dplyr", "ggpubr", "gt", "gtsummary", "haven", "Hmisc", "knitr", "lmtest", "lavaan", "mice", "modelsummary", "plm", "RColorBrewer", "sandwich", "srvyr", "targets", "tidyverse", "tseries", "webshot2", "weights"))
```

You will then need to ensure the packages `dplyr`, `targets`,  and `conflicted` are loaded into your R environment. The authors recommend typing the following into the console, and pressing `<Enter>`.
```R
library(conflicts)
library(targets)
library(dplyr)
```

R has global name spacing, which means that functions from two packages can override each other. To ensure the functions in the `R` folder run correctly, once all your packages are downloaded, you must set up the `.Rprofile` file that was included in the `analysis_COVID.YAMH` folder. When you unzip the folder, the `.Rprofile` file will be entirely commented out (i.e., with a `#` next  to the line of text, which stops the program from reading it). You need to remove the `#` from the start of each line so that the `.Rprofile` file reads:
```R
# This file ensures that the functions in the `R` folder are read correctly. 
# To run the program smoothly, un-comment all the information under this line
# --------------------------------------------------------------------------
library(targets)
library(dplyr)
library(conflicted)
conflict_prefer("filter", "dplyr")
conflict_prefer("select", "dplyr")
conflict_prefer("rename", "dplyr")
conflict_prefer("mutate", "dplyr")
conflict_prefer("summarise", "dplyr")
conflict_prefer("arrange", "dplyr")
conflict_prefer("group_by", "dplyr")
conflict_prefer("relevel", "dplyr")
```

To ensure that the user-made functions included in this replication package run properly, and draw on the correct software libraries, the `conflicts` package defines the specification of which libraries are preferred as the program runs. When this `conflicts` function is applied in a `.Rprofile` file, the command is applied to the entire working directory.
### Memory and Runtime Requirements
The approximate time needed to reproduce the analyses on a standard 2022 desktop machine <70 minutes. The code was last run on a **2022 M2 Apple MacBook Air laptop operating with MacOS version Ventura 13.6.1**. 
## Program pipeline and description 
### The pipeline
The `_targets.R` file contains directions for which files from the R folder should be read and when. Amongst other benefits, the Targets pipeline framework ensures all programs are consistently ran in the same order, and any updates to a function or a file will cause the pipeline to re-run and update all outputs connected to the update. Another benefit of the targets program is that all files are sourced within the workspace. In other words, you can keep all the file paths the same in the pipeline (so long at the data downloads follow the instructions in this README file). Table 3 summarises each step in the pipeline. 

**Table 3:**
*A table listing the targets generated in the `_targets.R` file* 

| Target                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Notes                                                                                                                                                                                                                                                                                                                          |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| uklhs19_indresp_file<br>uklhs19_egoalt_file<br>cov_file<br>cov2_file<br>cov3_file<br>hh7_grid_file<br>hh6_grid_file<br>hh5_grid_file<br>hh4_grid_file<br>hh3_grid_file<br>hh2_grid_file<br>hh1_grid_file<br>family7_derived_file<br>family6_derived_file<br>family5_derived_file<br>family4_derived_file<br>family3_derived_file<br>family2_derived_file<br>family1_derived_file<br>cm7_derived_file<br>cm6_derived_file<br>cm5_derived_file<br>cm4_derived_file<br>cm3_derived_file<br>cm2_derived_file<br>cm1_derived_file<br>cm4_int_file<br>cm5_int_file<br>cm6_int_file<br>cm7_int_file<br>parent5_derived_file<br>parent6_derived_file | N/A                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Almost all relevant files are loaded into local environment, and can be read into following pipeline functions*                                                                                                                                                                                                                |
| working_data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | combine_functions_dfs(<br>       cov_file, <br>       cm6_int_file,<br>       cm5_int_file,<br>       hh7_grid_file,<br>       hh6_grid_file,<br>       hh5_grid_file,<br>       hh4_grid_file,<br>       hh3_grid_file,<br>       hh2_grid_file,<br>       hh1_grid_file,<br>       family7_derived_file,<br>       family6_derived_file,<br>       family5_derived_file,<br>       family4_derived_file,<br>       family3_derived_file,<br>       family2_derived_file,<br>       family1_derived_file,<br>       parent6_derived_file,<br>       parent5_derived_file,<br>       cm7_derived_file,<br>       cm6_derived_file,<br>       cm5_derived_file,<br>       cm4_derived_file,<br>       cm3_derived_file,<br>       cm2_derived_file,<br>       cm1_derived_file)                                                                                        | Creates a dataframe with the first wave of the CLS COVID-19 survey and the MCS mainstage survey. All variables from all waves are included.                                                                                                                                                                                    |
| selected_df                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | select_analysis_vars(<br>       working_data)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Calls a the `working_data` dataframe. Selects and relevels variables of interest. Filters such that only people who participated in the seventh mainstage survey wave and the first CLS COVID-19 wave were included.                                                                                                           |
| alloutcomes_wide                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | allcovwaves_wide_df(<br>       cov_file,<br>       cov2_file,<br>       cov3_file,<br>       cm7_int_file,<br>       cm6_int_file,<br>       cm5_int_file,<br>       cm4_int_file,<br>       hh7_grid_file,<br>       hh6_grid_file,<br>       hh5_grid_file,<br>       hh4_grid_file,<br>       hh3_grid_file,<br>       hh2_grid_file,<br>       hh1_grid_file,<br>       family7_derived_file,<br>       family6_derived_file,<br>       family5_derived_file,<br>       family4_derived_file,<br>       family3_derived_file,<br>       family2_derived_file,<br>       family1_derived_file,<br>       parent6_derived_file,<br>       parent5_derived_file,<br>       cm7_derived_file,<br>       cm6_derived_file,<br>       cm5_derived_file,<br>       cm4_derived_file,<br>       cm3_derived_file,<br>       cm2_derived_file,<br>       cm1_derived_file) | Constructs a wide dataset containing all waves of data from the CLS COVID-19 survey.                                                                                                                                                                                                                                           |
| imputed.w1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | multipleimpute.w1_function(<br>       selected_df)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | An imputation model that generates 30 potential wide datasets, which are then pooled together during analysis.                                                                                                                                                                                                                 |
| imputed_sib                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | multipleimpute_sibcv.w1(<br>       selected_df)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | An imputation model that generates 30 potential wide datasets, which are then pooled together during analysis.                                                                                                                                                                                                                 |
| imputed.w2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | multipleimpute.w2_function<br>       alloutcomes_wide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | An imputation model that generates 30 potential wide datasets, which are then pooled together during analysis.                                                                                                                                                                                                                 |
| imputed.w3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | multipleimpute.w3_function(<br>       alloutcomes_wide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | An imputation model that generates 30 potential wide datasets, which are then pooled together during analysis.                                                                                                                                                                                                                 |
| imputed_w01_long                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | mi_0.1_long(<br>       alloutcomes_wide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | An imputation model that generates 30 potential long datasets, which are then pooled together during analysis.                                                                                                                                                                                                                 |
| imputed_w02_long                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | mi_0_2_long(<br>       alloutcomes_wide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | An imputation model that generates 30 potential long datasets, which are then pooled together during analysis.                                                                                                                                                                                                                 |
| imputed_w03_long                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | mi_0_3_long(<br>       alloutcomes_wide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | An imputation model that generates 30 potential long datasets, which are then pooled together during analysis.                                                                                                                                                                                                                 |
| Figure_Df                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | figure_df.function(<br>       selected_df)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | A dataframe generated using a dataset of only observed values. Summarises the mean and var of the outcome variable by gender and residence using the `selected_df` dataframe                                                                                                                                                   |
| Figure01_cc.WB                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Figure1_function.WB(<br>       Figure_Df,<br>       wb.se,<br>       wb.n)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Generates a pdf file and a `gg` object for SWEMWBS measures for Figure 1                                                                                                                                                                                                                                                       |
| Figure01_cc.K6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Figure1_function.K6(<br>       Figure_Df,<br>       k6.se,<br>       k6.n)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Generates a pdf file and a `gg` object for K6 measures for Figure 1                                                                                                                                                                                                                                                            |
| Table01_w1.cc.desc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | descriptive_table(<br>       selected_df)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Generates a table of the descriptives for the sample. The Table includes summaries of variables with missing observations. Imputed variables must be corrected using selected descriptive information generated from the imputed data frame.                                                                                   |
| TableA2_w2.cc.desc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | TableA02_w2_descriptives(<br>       alloutcomes_wide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Generates a table of the descriptives for the sample. The Table includes summaries of variables with missing observations. Imputed variables must be corrected using selected descriptive information generated from the imputed data frame.                                                                                   |
| TableA2_w3.cc.desc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | TableA02_w3_descriptives(<br>       alloutcomes_wide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Generates a table of the descriptives for the sample. The Table includes summaries of variables with missing observations. Imputed variables must be corrected using selected descriptive information generated from the imputed data frame.                                                                                   |
| Table01_w1.mi.desc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | descriptives_mi.cv.w1(<br>       imputed.w1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Provides a small dataframe with information that corrects the descriptive information for the imputed outcome and time-invariant explanatory variables.                                                                                                                                                                        |
| TableA01_w2.mi.desc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | descriptives_mi.cv.w2(<br>       imputed.w2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Provides a small dataframe with information that corrects the descriptive information for the imputed outcome and time-invariant explanatory variables.                                                                                                                                                                        |
| TableA01_w3.mi.desc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | descriptives_mi.cv.w3(<br>       imputed.w3)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Provides a small dataframe with information that corrects the descriptive information for the imputed outcome and time-invariant explanatory variables.                                                                                                                                                                        |
| descriptives_alone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | descriptive_table_alone(<br>       selected_df)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | A table of descriptives verbally reported in the manuscript.                                                                                                                                                                                                                                                                   |
| descriptives_na                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | descriptive_table_missing(<br>       selected_df)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | A table of descriptives verbally reported in the manuscript.                                                                                                                                                                                                                                                                   |
| A1_crosstab                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | crosstab_table(<br>       alloutcomes_wide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Summarise sample information regarding MCS members who participated in all three waves. The code generates two files, each with a crosstab of W1 x W(2-3). These two files must be combined by hand using a word processor. In the manuscript tables, the authors also included two rows of N via summing each column by hand. |
| Table02_mi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | modelsummary_w1mi(<br>       imputed.w1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Main analytical model                                                                                                                                                                                                                                                                                                          |
| Table03_mi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | modelsummary_sib(<br>       imputed_sib)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Sibling-only analysis                                                                                                                                                                                                                                                                                                          |
| Table04_mi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | modelsummary_3w(<br>       imputed.w1,<br>       imputed.w2,<br>       imputed.w3)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 3-wave lagged dependent variable OLS analysis (1 LDV OLS analysis per wave)                                                                                                                                                                                                                                                    |
| femodel_TableA03_mi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | fixedmodels_1(<br>       imputed_w01_long)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Fixed effects model with t = {1,2}, where 1 = MCS mainstage Wave 7 and 2 = CLS COVID-19 survey Wave 1.                                                                                                                                                                                                                         |
| TableA03_mi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | modelsummary_femodels(<br>       femodel_TableA03_mi,<br>       "A03_Table-fe01")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Model summary of the fixed effects model.                                                                                                                                                                                                                                                                                      |
| mcs.cv.response. check                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | cov_response_df(<br>       cov_file,<br>       cov2_file,<br>       cov3_file)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Crosstabulation of the number of MCS young adult participants at each wave of the CLS COVID-19 survey.                                                                                                                                                                                                                         |
| inc_res_xtab                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | xtab.inc_res(<br>       selected_df)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | In response to peer review comments, cross-tabulates associations between income quintiles at age 14, residence, and mental health.                                                                                                                                                                                    .       |
| uklhs_dataset                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | covid_uklhs(<br>       uklhs19_indresp_file,<br>       uklhs19_egoalt_file)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Constructs a dataset similar to the `selected_df` but with UKLLHS COVID-19 survey data.                                                                                                                                                                                                                                        |
| uklhs_model                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | summary_models_uklhs(<br>       uklhs_dataset)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Prints a model similar to our main analysis with UKLHS data                                                                                                                                                                                                                                                                    |

### User-made functions contained in the `R` folder
The objects created in the pipeline are all called with a user-made function. Every user-made function is stored and read in the `R` folder.  Table 4 summarises each file in the R folder, and which pipeline objects are associated with each file.

**Table 4:**
*A table describing the files in the `R` folder  by file name, the object created in the `_targets.R` pipeline with the functions defined in the file, and any relevant notes pertaining to each file* 

| File                          | Pipeline Objects                                                                             | Notes                                                                                                                                                                                                    |
| ----------------------------- | -------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| builddf_a.base_functions.R    | N/A                                                                                          | This file contains builder functions required in more than one function throughout analysis (e.g., load tab file functions, MCS-specific raw data filtering functions)                                   |
| builddf_b.combine_functions.R | data frame: `working_data`                                                                   |                                                                                                                                                                                                          |
| builddf_c.select_vars.R       | data frame: `selected_df`                                                                    |                                                                                                                                                                                                          |
| builddf_d.covwaves_wide.R     | data frame: `alloutcomes_wide`                                                               |                                                                                                                                                                                                          |
| builddf_e.MI_w0123.R          | data frame: `imputed_wx`, where `x` = {1:3}                                                  |                                                                                                                                                                                                          |
| builddf_f.MI_w0123.long.R     | data frame: `imputed_w0x_long`, where `x` = {1:3}                                            |                                                                                                                                                                                                          |
| builddf_g.UKLHS.R             | data frame: `uklhs_dataset`                                                                  |                                                                                                                                                                                                          |
| descriptives_z.na.alone.R     | gt tables: `descriptives_alone` and `descriptives_na`                                        |                                                                                                                                                                                                          |
| Figure01.R                    | gg objects: `Figure01_cc.K6` and `Figure01_cc.WB`                                            | This file will also save the figures as PDFs into the `\Figures_Tables` folder. For the manuscript, the authors combined these pdfs by hand.                                                             |
| Table01_A01_mi.corrections.R  | mipo summary objects: `Table01_w1.mi.desc`, `TableA01_w2.mi.desc`, and `TableA01_w3.mi.desc` | These can be viewed in the R environment and appear as data frames. The information is added by hand to their respective descriptive table.                                                              |
| Table01_desc.R                | gt tables: `Table01_w1.cc.desc`                                                              | Information is for complete case only. Variables that need imputation are incorrect. Incorrectly summarised information needs to be added by hand via the `Table01_mi.descriptives` mipo summary object. |
| Table02_main.analysis.R       | gt table: `Table02_mi`                                                                       | This file will also save table as an .rtf file into the `\Figures_Tables` folder.                                                                                                                                                                                                         |
| Table03_sib.analysis.R        | gt table: `Table03_mi`                                                                       | This file will also save table as an .rtf file into the `\Figures_Tables` folder.                                                                                                                                                                                                         |
| Table04_3w.main.analysis.R    | gt table: `Table04_mi`                                                                       | This file will also save table as an .rtf file into the `\Figures_Tables` folder.                                                                                                                                                                                                         |
| TableA01_descriptives.xtab.R  | gt table: `TableA01_crosstab`                                                                | This file will also save table as an .rtf file into the `\Figures_Tables` folder.                                                                                                                                                                                                         |
| TableA02_descriptives.R       | gt tables: `TableA2_w2.cc.desc` and `TableA01_w3.mi.desc`                                    | This file will also save tables as .rtf files into the `\Figures_Tables` folder. For the manuscript, the authors combined these files by hand.                                                           |
| TableA03_fe.models.R          | `femodel_TableA03_mi` and gt table: `TableA03_mi`                                            | This file will also save table as an .rtf file into the `\Figures_Tables` folder.                                                                                                                                                                                                         |
| Tables.PeerReview_UKLHS.R     | gt table: `uklhs_model`                                      | This file will also save table as an .rtf file into the `\Figures_Tables` folder.                                                                                                                                                                                                        |
| Tables.PeerReview_xtraxtab.R  | gt tables: `inc_res_xtab` and `inc_res_ols`                                                  |  This file will also save tables as .rtf files into the `\Figures_Tables` folder.                                                                                                                                                                                                        |
| var_age17_residence.R         | N/A                                                                                          |                                                                                                                                                                                                          |
| var_covid_covars.R            | N/A                                                                                          |                                                                                                                                                                                                          |
| var_ethnicity.R               | N/A                                                                                          |                                                                                                                                                                                                          |
| var_family_income.R           | N/A                                                                                          |                                                                                                                                                                                                          |
| var_outcome_lag_covid.R       | N/A                                                                                          |                                                                                                                                                                                                          |
| var_parent_education.R        | N/A                                                                                          |                                                                                                                                                                                                          |
| var_parent_structure.R        | N/A                                                                                          |                                                                                                                                                                                                          |
| var_region.R                  | N/A                                                                                          |                                                                                                                                                                                                          |
| var_siblingfactors.R          | N/A                                                                                          |                                                                                                                                                                                                          |
*Notes:* All dataframes are generated into the targets environment. To load and inspect the dataframe in the R environment, type the command `tar_load(X)` into the console, replace the 'X' with the name of the pipeline object of interest. `gt table` and `gg` objects are generated into a readable format that is stored in the `\Figures_Tables\` file (either as a pdf for gg object or rtf file for gt table objects).  Files which start with '`var_`' are user made variable derivation functions, and are called in `builddf_b.combine_functions.R` to create the initial `working_data` or in `builddf_d.covwaves_wide.R` dataset.
## Instructions to Replicators

- Download data from the UKDS
- Edit `R/builddf_g.UKLHS.R` to adjust the default path
- In the console, type `tar_make()` and press `<Enter>`
- After the program has finished running, type `tar_load_everything()` to investigate all the objects
## List of Final Figures and Table 
The provided code reproduces the files used to write the manuscript and respond to peer review. All tables produced here require data downloaded from the UKDS. Some Table specifics have been generated by hand (e.g., formatting .rtf files and combining tables). Table  5 summarises the Figures and Tables used in the manuscript, appendix, and peer review response by name and by output file, which is stored in the `Figures_Tables` folder.

**Table 5:**
A table listing each figure and table generated for the manuscript, appendix, and peer review. Each figure and table is also listed with their output file name and any notes needed to recreate what is seen in the manuscript.

| Name                | Output File Name                                                                                                                                        | Note                                                                                                                                                                                                                                                                                     |
| -------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Figure 1             | 01_Figure_K6.pdf,<br> 01_Figure_WB.pdf                                                                                                             | The functions produce a .pdf file –  for each outcome measure. These need to be combined by hand to produce the single chart in the paper.                                                                                                                                               |
| Table 1              | 01_Table_uncorrected.rtf, Table01_mi.descriptives (R dataframe)                                                                                    | The descriptive table ('01_Table_uncorrected') does not account for imputed values. Imputed values are generated separately and, once generated, can be loaded into the R environment and viewed, with the `View()` command. The original Table is then corrected and formatted by hand. |
| Table 2              | 02_Table_mi.interaction.rtf                                                                                                                        |                                                                                                                                                                                                                                                                                          |
| Table 3              | 03_Table_mi.sib.rtf                                                                                                                                |                                                                                                                                                                                                                                                                                          |
| Table 4              | 04_Table_3w.main.rtf                                                                                                                               |                                                                                                                                                                                                                                                                                          |
| Appendix Table A1    | A01_Table-crosstab.wave12.rtf, A01_Table-crosstab.wave13.rtf                                                                                       | Requires simple addition and combining by hand.                                                                                                                                                                                                                                          |
| Appendix Table A2    | A02_Table.w2_descriptives.rtf, A02_Table.w3_descriptives.rtf, TableA01_w2.mi.descriptives (R dataframe), TableA01_w3.mi.descriptives (R dataframe) | Like Table 1, the descriptive tables initially generated need to be corrected by hand. Requires table combination and correction to the estimates of imputed variables                                                                                                                   |
| Appendix Table A3    | A03_Table-fe01.rtf                                                                                                                                 |                                                                                                                                                                                                                                                                                          |
| Extra Table: Missing | 0X_Table_desc.na.rtf                                                                                                                               |                                                                                                                                                                                                                                                                                          |
| Extra Table: Alone   | 0X_Table_desc.alone.rtf                                                                                                                            |                                                                                                                                                                                                                                                                                          |
| Peer Review Table 1  | PR01_Table_uklhs_xtabfe.rtf, PR01_Table_uklhs_xtabma.rtf                                                                                           | Requires hand combination                                                                                                                                                                                                                                                                |
| Peer Review Table 2  | PR02_Table_uklhs_ldvols.rtf                                                                                                                        |                                                                                                                                                                                                                                                                                          |
| Peer Review Table 3  | PR03_Table_incres_xtab.rtf                                                                                                                         | Requires some hand addition of the 'N' row. As well, the Chi Square outcomes are printed in the                                                                                                                                                                                                                                                        |
| Peer Review Table 4  | PR04_Table_inc_strat.rtf                                                                                                                           |                                                                                                                                                                                                                                                                                          |

## References
Landau, W.M. _et al._ (2023) ‘targets: Dynamic Function-Oriented ’Make’-Like Declarative Pipelines’. Available at: [https://cran.r-project.org/web/packages/targets/index.html](https://cran.r-project.org/web/packages/targets/index.html).

University of London, Institute of Education, Centre for Longitudinal Studies (CLS) (2022). _Millennium Cohort Study: Age 9 months, Sweep 1, 2001_. [data collection]. _14th Edition._ UK Data Service. SN: 4683, [DOI: http://doi.org/10.5255/UKDA-SN-4683-6](http://doi.org/10.5255/UKDA-SN-4683-6)

University of London, Institute of Education, Centre for Longitudinal Studies (CLS) (2022). _Millennium Cohort Study: Age 3, Sweep 2, 2004_. [data collection]. _11th Edition._ UK Data Service. SN: 5350, [DOI: http://doi.org/10.5255/UKDA-SN-5350-6](http://doi.org/10.5255/UKDA-SN-5350-6)

University of London, Institute of Education, Centre for Longitudinal Studies (CLS) (2022). _Millennium Cohort Study: Age 5, Sweep 3, 2006_. [data collection]. _9th Edition._ UK Data Service. SN: 5795, [DOI: http://doi.org/10.5255/UKDA-SN-5795-6](http://doi.org/10.5255/UKDA-SN-5795-6)

University of London, Institute of Education, Centre for Longitudinal Studies (CLS). (2020). _Millennium Cohort Study: Fourth Survey, 2008_. [data collection]. _8th Edition._ UK Data Service. SN: 6411, [DOI: http://doi.org/10.5255/UKDA-SN-6411-8](http://doi.org/10.5255/UKDA-SN-6411-8)

University of London, Institute of Education, Centre for Longitudinal Studies (CLS). (2020). _Millennium Cohort Study: Fifth Survey, 2012_. [data collection]. _5th Edition._ UK Data Service. SN: 7464, [DOI: http://doi.org/10.5255/UKDA-SN-7464-5](http://doi.org/10.5255/UKDA-SN-7464-5)

University of London, Institute of Education, Centre for Longitudinal Studies (CLS). (2020). _Millennium Cohort Study: Sixth Survey, 2015_. [data collection]. _7th Edition._ UK Data Service. SN: 8156, [DOI: http://doi.org/10.5255/UKDA-SN-8156-7](http://doi.org/10.5255/UKDA-SN-8156-7)

University of London, Institute of Education, Centre for Longitudinal Studies (CLS). (2022). _Millennium Cohort Study: Age 17, Sweep 7, 2018_. [data collection]. _2nd Edition._ UK Data Service. SN: 8682, [DOI: http://doi.org/10.5255/UKDA-SN-8682-2](http://doi.org/10.5255/UKDA-SN-8682-2)

University College London, UCL Institute of Education, Centre for Longitudinal Studies (CLS). (2022). _COVID-19 Survey in Five National Longitudinal Cohort Studies: Millennium Cohort Study, Next Steps, 1970 British Cohort Study and 1958 National Child Development Study, 2020-2021_. [data collection]. _4th Edition._ UK Data Service. SN: 8658, [DOI: http://doi.org/10.5255/UKDA-SN-8658-4](http://doi.org/10.5255/UKDA-SN-8658-4)

---
